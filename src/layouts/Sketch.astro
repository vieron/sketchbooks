---
import Layout from "./Layout.astro";
import type p5 from "p5";

type Sketch = ((p: p5) => void) &
  Partial<{
    preloadFonts: (p: p5) => Promise<void>;
  }>;

declare global {
  interface Window {
    sketch: Sketch;

    // our own sketch handlers
    onCanvasResize: () => void;
  }
}

interface Props {
  title: string;
}

const { title } = Astro.props;
---

<Layout title={title}>
  <slot />
  <style is:global>
    canvas {
      display: block;
    }
  </style>
  <script>
    import p5 from "p5";

    async function initP5() {
      try {
        // import the p5 and p5-sounds client-side
        // const p5 = (await import("p5")).default;
        const sketch = window.sketch ?? (() => {});

        new p5((p) => sketch(p));
      } catch (error) {
        console.log(error);
      }
    }

    async function init() {
      await initP5();
    }

    init();
  </script>
</Layout>
