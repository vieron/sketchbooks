---
import Layout from "./Layout.astro";

interface Props {
  title: string;
}

const { title } = Astro.props;
---

<Layout title={title}>
  <slot />
  <style is:global>
    canvas {
      display: block;
    }
  </style>
  <script>
    import p5 from "p5";

    type Sketch = ((p: p5) => void) &
      Partial<{
        preloadFonts: (p: p5) => Promise<void>;
      }>;

    declare global {
      interface Window {
        sketch: Sketch;

        // our own sketch handlers
        onCanvasResize: () => void;
      }
    }

    function initP5() {
      try {
        // import the p5 and p5-sounds client-side
        // const p5 = (await import("p5")).default;
        const sketch = window.sketch ?? (() => {});

        new p5(
          (p) => sketch(p),
          document.getElementById("p5-sketch") as HTMLElement
        );
      } catch (error) {
        console.log(error);
      }
    }

    async function init() {
      initP5();
    }

    window.addEventListener("DOMContentLoaded", () => {
      init();
    });
  </script>
</Layout>
