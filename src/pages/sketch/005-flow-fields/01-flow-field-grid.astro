---
import Sketch from "../../../layouts/Sketch.astro";
---

<Sketch title="004 Flow fields">
  <script>
    import "p5";
    import { Color, Vector } from "p5";

    const noiseScale = 0.004;

    window.setup = () => {
      createCanvas(windowWidth, windowHeight);
    };

    function drawArrow(base: Vector, vec: Vector, myColor: Color) {
      push();
      stroke(myColor);
      strokeWeight(1);
      fill(myColor);
      translate(base.x, base.y);
      line(0, 0, vec.x, vec.y);
      rotate(vec.heading());

      let arrowSize = 2;
      translate(vec.mag() - arrowSize, 0);
      triangle(0, arrowSize / 2, 0, -arrowSize / 2, arrowSize, 0);
      pop();
    }

    let z: number = 0;
    window.draw = () => {
      background(color("white"));

      const cellWidth = windowWidth / 80;
      const cellHeight = windowHeight / 40;

      for (let x = 0; x < windowWidth; x += cellWidth) {
        for (let y = 0; y < windowHeight; y += cellHeight) {
          z++;
          const centerX = x + cellWidth / 2;
          const centerY = y + cellHeight / 2;

          // stroke(0, 0, 0, 25);
          // noFill();
          // rect(x, y, cellWidth, cellHeight);

          // Create a p5.Vector to the center.
          const v0 = createVector(x + cellWidth, y + cellHeight);
          const n = noise(x * noiseScale, y * noiseScale, z * 0.000002);
          const angle = map(n, 0, 1, 0, TAU);

          // Create a p5.Vector with an angle 0 and magnitude 30.
          const v1 = Vector.fromAngle(angle, Math.min(cellWidth, cellHeight));

          drawArrow(v0, v1, color("black"));
        }
      }

      // noLoop();
    };
  </script>
</Sketch>
